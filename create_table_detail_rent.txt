create table detail_rent (
	id serial primary key,
	rent_id int not null,
	item_id int not null,
	unit_price numeric not null,
	qty int not null,
	subtotal numeric(12, 2) GENERATED ALWAYS AS ((qty::numeric * unit_price)) STORED NULL,
	created_at timestamp DEFAULT CURRENT_TIMESTAMP NULL,
	updated_at timestamp DEFAULT CURRENT_TIMESTAMP NULL,
	foreign key (rent_id) references rents (id),
	foreign key (item_id) references items (id)
);

CREATE OR REPLACE FUNCTION set_unit_price_from_item()
RETURNS TRIGGER AS $$
BEGIN
    -- Ambil harga sewa dari tabel dresses berdasarkan dress_id
    SELECT price INTO NEW.unit_price
    FROM items
    WHERE id = NEW.item_id;

    -- Hitung subtotal otomatis
    NEW.subtotal := NEW.qty * NEW.unit_price;
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER trg_set_unit_price
BEFORE INSERT OR UPDATE ON detail_purchsing
FOR EACH ROW
EXECUTE FUNCTION set_unit_price_from_item();